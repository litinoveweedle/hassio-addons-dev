#!/command/with-contenv bashio
# shellcheck shell=bash
# shellcheck disable=SC2207
# ==============================================================================
# Li Tin O've Weedle Add-on: ntopng
# Handles configuration
# ==============================================================================

if bashio::config.has_value 'geoip_account_id'; then
    if bashio::config.has_value 'geoip_license_key'; then
        # Create GeoIP config
    	bashio::log.info "Found a Maxmind account id and license key pair, ntopng will support GeoIP lookups if valid."
        echo -e "AccountID $(bashio::config 'geoip_account_id')\nLicenseKey $(bashio::config 'geoip_license_key')\nEditionIDs GeoLite2-ASN GeoLite2-City GeoLite2-Country\nDatabaseDirectory /data/geoip" > /etc/GeoIP.conf

        # Create GeoIP persistent directory
        cnt=0
        if ! bashio::fs.directory_exists /data/geoip; then
            mkdir -p /data/geoip
        fi
    else
        bashio::log.warning "No Maxmind GeoIP license key was found, ntop will not support GeoIP lookups. Please get a license from maxmind.com and put it into configuration."
    fi
else
    bashio::log.warning "No Maxmind GeoIP account id was found, ntop will not support GeoIP lookups. Please get a license from maxmind.com and put it into configuration."
fi
